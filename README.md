* [Show All Code](#)
* [Hide All Code](#)
* [Download Rmd](#)

# R Notebook

# Project Zero

This project is concerned with looking at evolutionary signatures of selection on immune-associated genes, both canonical and candidate. All immune genes (canon/noncanon) are based on orthologs from Apis mellifera (Amel_HAv3.1, NCBI genome).

Two types of analyses have been previously ran using PAML's module, codeml, using gene product codon alignments consisting of 11 bee species, including Apis mellifera. Gene sets are divided into "immunity" and "random", with immunity consisting of "canon" and "non-canon". All alignments consist of 1-1 single-copy orthologs present in all 11 species. Those that did not include all species were dropped.

Evolutionary rate of each gene product was estimated using a codeml run that considers the whole gene product across the given phylogeny as a whole. It is not expected to get dN/dS ratio (omega) values anywhere near 1 (positive selection) using this method as site-specific signals of selection will be likely lost as the ratio is averaged along the length of the product. Instead, this is expected to offer a relative scale of evolutionary rate.

The main analysis consisted of branch-site specific analyses of selection wherein the phylogenetic tree was designated a target, splitting the tree into foreground and background. Codeml then estimates omega value for foreground branches relative to background. For the purposes of this project, each of the designations correspond with the origin or elaboration of social living, to assess if and how these changes in lifestyle affected selection on immune and candidate immune genes in the bees, relative to other genes (the "random" set, which encompass all orthologs that could be made from all proteins in Apis mellifera using the ortholog bash script, OrthoScript [imaginitively named]).

In the null version of this test, omega ratios on the foreground branches are fixed at 1, with the alternative version starting with omega estimates above 1 (a direct test of positive selection). Each model results in a global maximum log likelihoood score which can then be compared using a LRT.

LRT = (lnLAlt - lnLNull)*2

LRT scores can then be compared to a chi-square distribution with 1 degree of freedom to assess significance. LRT scores above 3.84 are considered significant.

P-values will be adjusted using during this analysis to correct for multiple testing using the Benjamini-Hochburg procedure.

# Setting the Verse

In order to annotate the data with class of gene, description of gene (as it is described in Apis mellifera), etc. we first need a "dataverse" of Amel_HAv3.1.

GeneVerse: created by reading in a file with all genes from Amel HAv3.1 complete with gene product description and transcript ID.

```
head(gene.verse)
```

ImmVerse: created by reading in a file with all immune - associated genes used as the input for the orthologue finding program which created the codon alignments used in the codeml branch-site selection analyses, complete with classifications, transcript, peptide and gene IDs.

```
head(imm.verse)
```

LS0tCnRpdGxlOiAiUiBOb3RlYm9vayIKb3V0cHV0OiBodG1sX25vdGVib29rCi0tLQojIFByb2plY3QgWmVybyAKClRoaXMgcHJvamVjdCBpcyBjb25jZXJuZWQgd2l0aCBsb29raW5nIGF0IGV2b2x1dGlvbmFyeSBzaWduYXR1cmVzIG9mIHNlbGVjdGlvbiBvbiBpbW11bmUtYXNzb2NpYXRlZCBnZW5lcywgYm90aCBjYW5vbmljYWwgYW5kIGNhbmRpZGF0ZS4gQWxsIGltbXVuZSBnZW5lcyAoY2Fub24vbm9uY2Fub24pIGFyZSBiYXNlZCBvbiBvcnRob2xvZ3MgZnJvbSBBcGlzIG1lbGxpZmVyYSAoQW1lbF9IQXYzLjEsIE5DQkkgZ2Vub21lKS4KClR3byB0eXBlcyBvZiBhbmFseXNlcyBoYXZlIGJlZW4gcHJldmlvdXNseSByYW4gdXNpbmcgUEFNTCdzIG1vZHVsZSwgY29kZW1sLCB1c2luZyBnZW5lIHByb2R1Y3QgY29kb24gYWxpZ25tZW50cyBjb25zaXN0aW5nIG9mIDExIGJlZSBzcGVjaWVzLCBpbmNsdWRpbmcgQXBpcyBtZWxsaWZlcmEuIEdlbmUgc2V0cyBhcmUgZGl2aWRlZCBpbnRvICJpbW11bml0eSIgYW5kICJyYW5kb20iLCB3aXRoIGltbXVuaXR5IGNvbnNpc3Rpbmcgb2YgImNhbm9uIiBhbmQgIm5vbi1jYW5vbiIuIEFsbCBhbGlnbm1lbnRzIGNvbnNpc3Qgb2YgMS0xIHNpbmdsZS1jb3B5IG9ydGhvbG9ncyBwcmVzZW50IGluIGFsbCAxMSBzcGVjaWVzLiBUaG9zZSB0aGF0IGRpZCBub3QgaW5jbHVkZSBhbGwgc3BlY2llcyB3ZXJlIGRyb3BwZWQuCgpFdm9sdXRpb25hcnkgcmF0ZSBvZiBlYWNoIGdlbmUgcHJvZHVjdCB3YXMgZXN0aW1hdGVkIHVzaW5nIGEgY29kZW1sIHJ1biB0aGF0IGNvbnNpZGVycyB0aGUgd2hvbGUgZ2VuZSBwcm9kdWN0IGFjcm9zcyB0aGUgZ2l2ZW4gcGh5bG9nZW55IGFzIGEgd2hvbGUuIEl0IGlzIG5vdCBleHBlY3RlZCB0byBnZXQgZE4vZFMgcmF0aW8gKG9tZWdhKSB2YWx1ZXMgYW55d2hlcmUgbmVhciAxIChwb3NpdGl2ZSBzZWxlY3Rpb24pIHVzaW5nIHRoaXMgbWV0aG9kIGFzIHNpdGUtc3BlY2lmaWMgc2lnbmFscyBvZiBzZWxlY3Rpb24gd2lsbCBiZSBsaWtlbHkgbG9zdCBhcyB0aGUgcmF0aW8gaXMgYXZlcmFnZWQgYWxvbmcgdGhlIGxlbmd0aCBvZiB0aGUgcHJvZHVjdC4gSW5zdGVhZCwgdGhpcyBpcyBleHBlY3RlZCB0byBvZmZlciBhIHJlbGF0aXZlIHNjYWxlIG9mIGV2b2x1dGlvbmFyeSByYXRlLgoKVGhlIG1haW4gYW5hbHlzaXMgY29uc2lzdGVkIG9mIGJyYW5jaC1zaXRlIHNwZWNpZmljIGFuYWx5c2VzIG9mIHNlbGVjdGlvbiB3aGVyZWluIHRoZSBwaHlsb2dlbmV0aWMgdHJlZSB3YXMgZGVzaWduYXRlZCBhIHRhcmdldCwgc3BsaXR0aW5nIHRoZSB0cmVlIGludG8gZm9yZWdyb3VuZCBhbmQgYmFja2dyb3VuZC4gQ29kZW1sIHRoZW4gZXN0aW1hdGVzIG9tZWdhIHZhbHVlIGZvciBmb3JlZ3JvdW5kIGJyYW5jaGVzIHJlbGF0aXZlIHRvIGJhY2tncm91bmQuIEZvciB0aGUgcHVycG9zZXMgb2YgdGhpcyBwcm9qZWN0LCBlYWNoIG9mIHRoZSBkZXNpZ25hdGlvbnMgY29ycmVzcG9uZCB3aXRoIHRoZSBvcmlnaW4gb3IgZWxhYm9yYXRpb24gb2Ygc29jaWFsIGxpdmluZywgdG8gYXNzZXNzIGlmIGFuZCBob3cgdGhlc2UgY2hhbmdlcyBpbiBsaWZlc3R5bGUgYWZmZWN0ZWQgc2VsZWN0aW9uIG9uIGltbXVuZSBhbmQgY2FuZGlkYXRlIGltbXVuZSBnZW5lcyBpbiB0aGUgYmVlcywgcmVsYXRpdmUgdG8gb3RoZXIgZ2VuZXMgKHRoZSAicmFuZG9tIiBzZXQsIHdoaWNoIGVuY29tcGFzcyBhbGwgb3J0aG9sb2dzIHRoYXQgY291bGQgYmUgbWFkZSBmcm9tIGFsbCBwcm90ZWlucyBpbiBBcGlzIG1lbGxpZmVyYSB1c2luZyB0aGUgb3J0aG9sb2cgYmFzaCBzY3JpcHQsIE9ydGhvU2NyaXB0IFtpbWFnaW5pdGl2ZWx5IG5hbWVkXSkuCgpJbiB0aGUgbnVsbCB2ZXJzaW9uIG9mIHRoaXMgdGVzdCwgb21lZ2EgcmF0aW9zIG9uIHRoZSBmb3JlZ3JvdW5kIGJyYW5jaGVzIGFyZSBmaXhlZCBhdCAxLCB3aXRoIHRoZSBhbHRlcm5hdGl2ZSB2ZXJzaW9uIHN0YXJ0aW5nIHdpdGggb21lZ2EgZXN0aW1hdGVzIGFib3ZlIDEgKGEgZGlyZWN0IHRlc3Qgb2YgcG9zaXRpdmUgc2VsZWN0aW9uKS4gRWFjaCBtb2RlbCByZXN1bHRzIGluIGEgZ2xvYmFsIG1heGltdW0gbG9nIGxpa2VsaWhvb29kIHNjb3JlIHdoaWNoIGNhbiB0aGVuIGJlIGNvbXBhcmVkIHVzaW5nIGEgTFJULgoKTFJUID0gKGxuTEFsdCAtIGxuTE51bGwpKjIKCkxSVCBzY29yZXMgY2FuIHRoZW4gYmUgY29tcGFyZWQgdG8gYSBjaGktc3F1YXJlIGRpc3RyaWJ1dGlvbiB3aXRoIDEgZGVncmVlIG9mIGZyZWVkb20gdG8gYXNzZXNzIHNpZ25pZmljYW5jZS4gTFJUIHNjb3JlcyBhYm92ZSAzLjg0IGFyZSBjb25zaWRlcmVkIHNpZ25pZmljYW50LiAKClAtdmFsdWVzIHdpbGwgYmUgYWRqdXN0ZWQgdXNpbmcgZHVyaW5nIHRoaXMgYW5hbHlzaXMgdG8gY29ycmVjdCBmb3IgbXVsdGlwbGUgdGVzdGluZyB1c2luZyB0aGUgQmVuamFtaW5pLUhvY2hidXJnIHByb2NlZHVyZS4KCiNTZXR0aW5nIHRoZSBWZXJzZQoKSW4gb3JkZXIgdG8gYW5ub3RhdGUgdGhlIGRhdGEgd2l0aCBjbGFzcyBvZiBnZW5lLCBkZXNjcmlwdGlvbiBvZiBnZW5lIChhcyBpdCBpcyBkZXNjcmliZWQgaW4gQXBpcyBtZWxsaWZlcmEpLCBldGMuIHdlIGZpcnN0IG5lZWQgYSAiZGF0YXZlcnNlIiBvZiBBbWVsX0hBdjMuMS4KCgpgYGB7ciwgaW5jbHVkZT1GQUxTRX0Kc291cmNlKCJ2ZXJzZVNldC5SIiwgbG9jYWwgPSBrbml0cjo6a25pdF9nbG9iYWwoKSkKYGBgCgpHZW5lVmVyc2U6IGNyZWF0ZWQgYnkgcmVhZGluZyBpbiBhIGZpbGUgd2l0aCBhbGwgZ2VuZXMgZnJvbSBBbWVsIEhBdjMuMSBjb21wbGV0ZSB3aXRoIGdlbmUgcHJvZHVjdCBkZXNjcmlwdGlvbiBhbmQgdHJhbnNjcmlwdCBJRC4KCmBgYHtyfQpoZWFkKGdlbmUudmVyc2UpCmBgYAoKSW1tVmVyc2U6IGNyZWF0ZWQgYnkgcmVhZGluZyBpbiBhIGZpbGUgd2l0aCBhbGwgaW1tdW5lIC0gYXNzb2NpYXRlZCBnZW5lcyB1c2VkIGFzIHRoZSBpbnB1dCBmb3IgdGhlIG9ydGhvbG9ndWUgZmluZGluZyBwcm9ncmFtIHdoaWNoIGNyZWF0ZWQgdGhlIGNvZG9uIGFsaWdubWVudHMgdXNlZCBpbiB0aGUgY29kZW1sIGJyYW5jaC1zaXRlIHNlbGVjdGlvbiBhbmFseXNlcywgY29tcGxldGUgd2l0aCBjbGFzc2lmaWNhdGlvbnMsIHRyYW5zY3JpcHQsIHBlcHRpZGUgYW5kIGdlbmUgSURzLgoKYGBge3J9CmhlYWQoaW1tLnZlcnNlKQpgYGAKCg==
